---
layout: post
title: Git学习笔记
date: 2021-08-14
author: zxl19
tags: [Git, Note]
comments: true
toc: true
pinned: false
---

我的Git学习笔记。

<!-- more -->

## 基本概念

1. **工作目录**：持有实际文件；
2. **暂存区（Index）**：缓存区域，临时保存改动；
3. **HEAD**：指向最后一次提交的结果；

## 常用命令

1. 创建新仓库：

    ```shell
    # 在仓库文件夹中
    git init
    ```

2. 检出仓库：

    ```shell
    # 创建一个本地仓库的克隆版本
    git clone /path/to/repository
    # 创建远程服务器上仓库的克隆版本
    git clone username@host:/path/to/repository
    ```

3. 添加和提交：

    ```shell
    # 添加单个文件到暂存区
    git add <filename>
    # 添加所有文件到暂存区
    git add *
    # 提交改动到HEAD
    git commit -m "代码提交信息"
    ```

4. 推送改动：

    ```shell
    # 提交改动到远程服务器上仓库的master分支
    # 远程服务器的默认名为origin
    git push origin master
    ```

    ```shell
    # 显示远程服务器
    git remote -v
    # 连接仓库到远程服务器
    git remote add <name> <url>
    # 删除远程服务器
    git remote remove <name>
    # 重命名远程服务器
    git remote rename <old> <new>
    ```

5. 分支：将特性开发绝缘，默认主分支为`master`，**自2020年10月1日起，GitHub将新仓库的默认主分支改为`main`：**

    ```shell
    # 新建分支并切换
    # 相当于git branch + git checkout
    git checkout -b <branch>
    # 切换回主分支
    git checkout master
    # 删除分支
    git branch -d <branch>
    # 推送分支到远程仓库，使其对他人可见
    git push origin <branch>
    ```

6. 更新与合并：

    ```shell
    # 更新本地仓库至最新改动
    # 相当于git fetch + git merge
    git pull
    # 合并其他分支到当前分支
    git merge <branch>
    # 合并冲突后手动添加文件到暂存区
    git add <filename>
    # 预览差异
    git diff <source_branch> <target_branch>
    ```

7. 标签：

    ```shell
    # 创建标签
    git tag 1.0.0 [ID前十位]
    # 获取提交ID
    git log
    ```

8. 替换本地改动：

    ```shell
    # 使用HEAD中的最新内容替换掉工作目录中的文件
    # 已添加到暂存区的改动以及新文件都不会受到影响
    git checkout -- <filename>
    # 丢弃本地的所有改动与提交
    # 到服务器上获取最新的版本历史并将本地主分支指向它
    git fetch origin
    git reset --hard origin/master
    ```

    ```shell
    # 回退到某次提交，删除这次提交后的全部提交记录
    git reset <ID>
    # --soft：回退修改的内容在暂存区
    # --mixed：回退修改的内容在工作区（默认）
    # --hard：回退修改的内容被删除
    # 强制推送，谨慎使用！
    git push -f
    # 撤回某次提交的修改，增加新的提交记录
    git revert <ID>
    ```

9. 实用小贴士：

    - 内建的图形化git：

        ```shell
        gitk
        ```

    - 彩色的git输出：

        ```shell
        git config color.ui true
        ```

    - 显示历史记录时，每个提交的信息只显示一行：

        ```shell
        git config format.pretty oneline
        ```

    - 交互式添加文件到暂存区：

        ```shell
        git add -i
        ```

## 工作流程

1. 克隆远程仓库到本地：

    ```shell
    git clone username@host:/path/to/repository
    ```

2. 如果没有远程仓库主分支的修改权限，则需要在个人分支中进行修改；

    - 如果远程仓库中不存在个人分支，则需要在本地仓库中新建个人分支：

        ```shell
        # 基于远程仓库的主分支在本地仓库中新建个人分支，并自动关联远程仓库的主分支
        git checkout -b <branch> origin/master
        # 基于本地仓库的当前分支新建个人分支，不会关联远程仓库的分支
        git checkout -b <branch>
        ```

    - 如果远程仓库中存在个人分支，则需要在本地仓库中切换到个人分支：

        ```shell
        # 查看本地仓库和远程仓库的全部分支
        git branch -a
        # 切换到个人分支，自动关联远程仓库的分支
        git checkout <branch>
        ```

3. 本地修改，提交：

    ```shell
    git add *
    git commit -m "代码提交信息"
    ```

    ```shell
    # 查看工作区状态
    git status
    ```

4. 拉取远程仓库更新到本地：

    - 指定远程仓库的分支：

        ```shell
        git pull origin <branch>
        ```

    - 使用与本地仓库的当前分支关联的远程仓库的分支：

        ```shell
        git pull
        ```

    - 设置与本地仓库的当前分支关联的远程仓库的分支：

        ```cpp
        git branch --set-upstream-to=origin/<branch>
        ```

5. 在本地仓库合并远程仓库更新并测试；
6. 推送本地仓库修改到远程仓库：

    - 指定远程仓库的分支，如果远程仓库中不存在指定的分支会自动创建：

        ```shell
        # 远程仓库的分支名与本地仓库的分支名不同
        git push origin <local_branch>:<remote_branch>
        # 远程仓库的分支名与本地仓库的分支名相同
        git push origin <branch>
        ```

    - 使用与本地仓库的当前分支关联的远程仓库的分支：

        ```shell
        git push
        ```

    - 设置与本地仓库的当前分支关联的远程仓库的分支并推送：

        ```shell
        git push --set-upstream origin <branch>
        git push -u origin <branch>
        ```

## 使用技巧

### `.gitignore`文件

用于说明哪些文件或文件夹不需要被添加到版本管理中，在工作区的根目录下创建。

GitHub官方提供了模板：[github/gitignore](https://github.com/github/gitignore)，可根据实际情况选择使用。

### `.gitkeep`文件

用于添加空文件夹到版本管理中，在需要添加的空文件夹中创建。

如果需要添加的空文件夹已经被添加到`.gitignore`文件中，则需要强制添加`.gitkeep`文件到暂存区：

```shell
git add -f ./log/.gitkeep
```

### `.gitmodules`文件

用于记录仓库子模块的信息。

1. 添加子模块，注意使用相对路径，可以指定子模块的分支，会自动生成`.gitmodules`文件：

    ```shell
    git submodule add -b <submodule branch> <submodule url> <relative path to submodule>
    ```

    `.gitmodules`文件示例：

    ```text
    [submodule "<relative path to submodule>"]
        path = <relative path to submodule>
        url = <submodule url>
        branch = <submodule branch>
    ```

2. 在克隆远程仓库时添加`--recursive`循环克隆子模块：

    ```shell
    git clone username@host:/path/to/repository --recursive
    ```

3. 如果远程仓库已克隆完成，则需要单独克隆子模块：

    - 方法一：

        ```shell
        # 初始化本地配置文件,向`.git/config`文件中写入子模块信息
        # 可以修改`.git/config`文件中的子模块URL地址
        git submodule init
        # 按照`.git/config`文件中的子模块信息检出子模块
        git submodule update
        ```

    - 方法二：

        ```shell
        # 初始化本地配置文件并检出子模块
        git submodule update --init
        ```

4. 如果远程仓库添加了多个子模块，可以使用`git submodule foreach`命令对于每个子模块进行相同操作：

    - 循环克隆每个子模块内部嵌套的子模块：

        ```shell
        git submodule update --init
        git submodule foreach git submodule update --init
        ```

    - 循环拉取每个子模块远程仓库的更新（子模块的HEAD指向的是添加时的版本）：

        ```shell
        git submodule foreach git pull origin master
        ```

5. 在提交修改时，先提交子模块的修改，再提交当前仓库的修改；
6. 删除子模块：

    ```shell
    git submodule deinit <relative path to submodule>
    git rm <relative path to submodule>
    ```

## 参考

1. [Git教程-菜鸟教程](https://www.runoob.com/git/git-tutorial.html)
2. [git-简明指南](https://www.runoob.com/manual/git-guide/)
3. [git-the simple guide](https://rogerdudler.github.io/git-guide/)
4. [rogerdudler/git-guide](https://github.com/rogerdudler/git-guide)
5. [Git五分钟教程](https://www.runoob.com/w3cnote/git-five-minutes-tutorial.html)
6. [10月1日之后，你新建的GitHub库默认分支不叫「master」了-机器之心的文章-知乎](https://zhuanlan.zhihu.com/p/257179306)
7. [Git命令reset和revert的区别-Meng小羽的文章-知乎](https://zhuanlan.zhihu.com/p/412482122)
8. [git reset和revert的区别-CSDN博客](https://blog.csdn.net/qq_41800366/article/details/114943539)
9. [Git恢复之前版本的两种方法reset、revert（图文详解）-CSDN博客](https://blog.csdn.net/yxlshk/article/details/79944535)
10. [git创建本地与远程分支的同步与合并-掘金](https://juejin.cn/post/6844903713803337741)
11. [git本地新建分支和远程同步-CSDN博客](https://blog.csdn.net/goxingman/article/details/114519663)
12. [Git忽略文件.gitignore详解-CSDN博客](https://blog.csdn.net/ThinkWon/article/details/101447866)
13. [.gitignore-简书](https://www.jianshu.com/p/699ed86028c2)
14. [git的ignore文件在c++下的编写-CSDN博客](https://blog.csdn.net/dong_beijing/article/details/79860967)
15. [什么是.gitkeep？-CSDN博客](https://blog.csdn.net/qq_37164975/article/details/106131919)
16. [Git中submodule的使用-孤单彼岸的文章-知乎](https://zhuanlan.zhihu.com/p/87053283)
17. [Git子仓库深入浅出-那我懂你意思了的文章-知乎](https://zhuanlan.zhihu.com/p/100214931)
18. [How to Use git submodule init-PhoneixNAP](https://phoenixnap.com/kb/git-submodule-init)
19. [git子仓库(submodule)操作-CSDN博客](https://blog.csdn.net/whuzhang16/article/details/120182063)
20. [克隆子模块-Stack Overflow](https://stackoverflow.com/questions/24777973/adding-git-submodules-automatically-gitmodules)
21. [submodule指定对应分支-CSDN博客](https://blog.csdn.net/weboof/article/details/108517187)
22. [Git clone --recursive-博客园](https://www.cnblogs.com/love-zf/p/13192734.html)
23. [删除子模块-Stack Overflow](https://stackoverflow.com/questions/1260748/how-do-i-remove-a-submodule)
